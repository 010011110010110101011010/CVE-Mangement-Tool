from django.db import models
from django import forms

class CVE(models.Model):
    STATUS_CHOICES = [
        ('Patched', 'Patched'),
        ('Non-Patched', 'Non-Patched'),
        ('Directed', 'Directed To The Service Provider'),
    ]

    titre = models.TextField(db_column='title')
    date_pub = models.DateField(db_column='publication_date')
    num_ref = models.CharField(max_length=500, db_column='reference_number')
    risque = models.TextField(db_column='risk_level')
    impact = models.TextField(db_column='impact_level')
    syst_aff = models.TextField(db_column='affected_systems')
    ident_ext = models.TextField(db_column='external_identifiers')
    bilan_vuln = models.TextField(db_column='summary')
    solution = models.TextField(db_column='solution')
    risque2 = models.TextField(db_column='risk')
    annexe = models.TextField(db_column='reference')
    pdf = models.TextField(db_column='pdf')
    status = models.CharField(
        max_length=255,
        choices=STATUS_CHOICES,
        default='Non-Patched',
        db_column='status'
    )
    updated_at = models.DateTimeField(auto_now=True)  # Ensure this line is present

    class Meta:
        db_table = 'cves'

class Software(models.Model):
    id = models.AutoField(primary_key=True)
    name = models.CharField(max_length=100)
    version = models.CharField(max_length=50, blank=True, null=True)  # Allow NULL and blank
    build_number = models.CharField(max_length=50, blank=True, null=True)
    editor = models.CharField(max_length=100, blank=True, null=True)
    
    def __str__(self):
        return self.name

class SoftwareForm(forms.ModelForm):
    class Meta:
        model = Software
        fields = ['name', 'version', 'build_number', 'editor']
        widgets = {
            'name': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Software Name'}),
            'version': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Version'}),
            'build_number': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Build Number'}),
            'editor': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Editor'}),
        }